<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Spotify Emotion Player | Color Mix Edition</title>

  <script>
    if (!sessionStorage.getItem("spotify_access_token")) {
      window.location = "auth.html";
    }
  </script>

  <script src="https://sdk.scdn.co/spotify-player.js"></script>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>

<!-- ✅ Back Button statt "Home" -->
<a href="start.html" class="home-btn" aria-label="Zurück">
  <svg class="icon icon-back" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M14.5 5.5L8 12l6.5 6.5" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</a>

<div class="camera-overlay">
  <video id="video-feed" autoplay muted playsinline></video>
  <div class="emotion-stats">
    <div class="status-line" style="margin-bottom: 15px;">Status: <span class="status-highlight" id="emotion-text">Analysiere...</span></div>

    <div class="bar-group">
      <div class="bar-header" style="display:flex; justify-content:space-between; font-size:10px; text-transform: uppercase; letter-spacing: 1px;"><span>Happy</span><span id="val-happy">0%</span></div>
      <div class="bar-bg"><div id="bar-happy" class="bar-fill"></div></div>
    </div>

    <div class="bar-group" style="margin-top:12px;">
      <div class="bar-header" style="display:flex; justify-content:space-between; font-size:10px; text-transform: uppercase; letter-spacing: 1px;"><span>Neutral</span><span id="val-neutral">0%</span></div>
      <div class="bar-bg"><div id="bar-neutral" class="bar-fill"></div></div>
    </div>

    <div class="bar-group" style="margin-top:12px;">
      <div class="bar-header" style="display:flex; justify-content:space-between; font-size:10px; text-transform: uppercase; letter-spacing: 1px;"><span>Sad</span><span id="val-sad">0%</span></div>
      <div class="bar-bg"><div id="bar-sad" class="bar-fill"></div></div>
    </div>

    <div class="bar-group" style="margin-top:12px;">
      <div class="bar-header" style="display:flex; justify-content:space-between; font-size:10px; text-transform: uppercase; letter-spacing: 1px;"><span>Angry</span><span id="val-angry">0%</span></div>
      <div class="bar-bg"><div id="bar-angry" class="bar-fill"></div></div>
    </div>
  </div>
</div>

<!-- ✅ Player weiter nach unten -->
<main class="main-player">
  <img id="trackImage" src="https://via.placeholder.com/300/181818/ffffff?text=Spotify" alt="Cover" />
  <div id="trackTitle">Song</div>
  <div id="trackArtist">Künstler</div>

  <div class="player-controls">
    <div class="buttons-row">
      <button id="prevBtn" class="btn-circle" aria-label="Zurück">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M11 7l-6 5 6 5V7zM19 7l-6 5 6 5V7z" fill="currentColor"/>
        </svg>
      </button>

      <!-- ✅ Play/Pause mit SVG (kein Emoji) -->
      <button id="startBtn" class="btn-play" aria-label="Play/Pause">
        <svg class="icon icon-play" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M9 7l10 5-10 5V7z" fill="currentColor"/>
        </svg>
        <svg class="icon icon-pause" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M7 6h4v12H7zM13 6h4v12h-4z" fill="currentColor"/>
        </svg>
      </button>

      <button id="nextBtn" class="btn-circle" aria-label="Weiter">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M13 7l6 5-6 5V7zM5 7l6 5-6 5V7z" fill="currentColor"/>
        </svg>
      </button>
    </div>

    <div class="progress-row">
      <span id="currentTime" class="time">0:00</span>
      <input type="range" id="progressBar" min="0" max="100" value="0" disabled />
      <span id="durationTime" class="time">0:00</span>
    </div>
  </div>
</main>

<!-- ✅ Volume: Emoji weg + clean Speaker SVG -->
<div class="volume-control">
  <span class="volume-icon" aria-hidden="true">
    <svg class="icon" viewBox="0 0 24 24">
      <path d="M11 5L6.8 8.5H4a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h2.8L11 19V5z" fill="currentColor"/>
      <path d="M15.5 9.2a4 4 0 0 1 0 5.6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M18.2 6.5a7.5 7.5 0 0 1 0 11" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity="0.9"/>
    </svg>
  </span>
  <input type="range" id="volumeSlider" min="0" max="100" value="50" />
</div>

<div class="test-panel">
  <button style="background:#ffcc00" onclick="setEmotionTheme('happy')">H</button>
  <button style="background:#3b82f6; color:white" onclick="setEmotionTheme('sad')">S</button>
  <button style="background:#ffffff" onclick="setEmotionTheme('neutral')">N</button>
  <button style="background:#ef4444; color:white" onclick="setEmotionTheme('angry')">A</button>
</div>

<script>
  function setEmotionTheme(emotion) {
    const root = document.documentElement;

    const themes = {
      happy:   { color: '#ffcc00', bg: 'rgba(255, 204, 0, 0.45)', bgDark: '#2b2100' },
      sad:     { color: '#3b82f6', bg: 'rgba(59, 130, 246, 0.4)', bgDark: '#000d2b' },
      neutral: { color: '#ffffff', bg: 'rgba(255, 255, 255, 0.2)', bgDark: '#121212' },
      angry:   { color: '#ef4444', bg: 'rgba(239, 68, 68, 0.45)', bgDark: '#2b0000' }
    };

    const theme = themes[emotion] || themes.neutral;

    root.style.setProperty('--emotion-color', theme.color);
    root.style.setProperty('--emotion-bg', theme.bg);
    root.style.setProperty('--bg-dark', theme.bgDark);

    root.style.setProperty('--emotion-glow-strong', `color-mix(in srgb, ${theme.color} 65%, transparent)`);
    root.style.setProperty('--emotion-glow-soft', `color-mix(in srgb, ${theme.color} 28%, transparent)`);

    if (emotion === "neutral" || emotion === "sad") {
      root.style.setProperty('--bg-pulse-speed', '10s');
      root.style.setProperty('--bg-jitter-speed', '999s');
      root.style.setProperty('--bg-jitter-amp', '0%');
    } else if (emotion === "happy") {
      root.style.setProperty('--bg-pulse-speed', '5.5s');
      root.style.setProperty('--bg-jitter-speed', '7s');
      root.style.setProperty('--bg-jitter-amp', '2%');
    } else if (emotion === "angry") {
      root.style.setProperty('--bg-pulse-speed', '4.2s');
      root.style.setProperty('--bg-jitter-speed', '5.2s');
      root.style.setProperty('--bg-jitter-amp', '3%');
    }

    const textEl = document.getElementById('emotion-text');
    if (textEl) textEl.innerText = emotion.charAt(0).toUpperCase() + emotion.slice(1);
  }
</script>

<script src="face-api.min.js"></script>
<script src="camera.js?v=20260124_1"></script>
<script type="module" src="app.js"></script>

</body>
</html>
